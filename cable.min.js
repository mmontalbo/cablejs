/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-03-22T06:24:31.507Z              .
.......................................*/
var Cable={};
(function(){function c(a,d){for(var h in a)a.hasOwnProperty(h)&&d(a[h],h)}function b(a){return a.argAliases?a.argAliases:(a+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(a){return a.replace(/(^\s+)|(\s+$)/g,"")})}function f(a,d){return b(a).filter(function(a){return-1==q.indexOf(a)}).map(function(a){return a.replace(/^_/,"")})}function g(a,d){return b(a).filter(function(a){return-1==q.indexOf(a)&&"_"!=a[0]})}function k(a){var d={};return a&&"[object Function]"===d.toString.call(a)}
function l(a,d){if(d){var h={};c(a,function(a,e){h[e]=d.hasOwnProperty(e)?d[e]:a});return h}return a}function n(a){function d(h){if(h.length){var b=h[0],c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a="("+this.responseText+")";delete e[b];var c={};try{c[b]=eval(a)}catch(f){throw"Failed to load module '"+b+"': "+f;}Cable.define(c,{reify:!1,wireup:!1});d(h.slice(1))}};c.open("get",e[b].url,!0);c.send()}else a()}var h=[],b;for(b in e)e.hasOwnProperty(b)&&
"module"===e[b].type&&h.push(b);d(h)}function m(a,d){for(var h=d.chain,b="main"===a?"":"_"+a,c=[],f=0;f<h.length;++f)c.push(h.slice(0,h.length-f).join("_")+b);c.push(a);for(h=0;h<c.length;++h)if(e.hasOwnProperty(c[h]))return c[h];return null}function w(){c(e,function(a){a.out=[]});c(e,function(a,d){a.fn&&g(a.fn,a.context).forEach(function(h){var b=m(h,a.scope);if(b)e[b].out.push(d);else throw b=function(a){var d=[];c(a.references,function(a,b){d.push("'"+b+"' ==> '"+a+"'")});return"named '"+a.name+
"' and references {"+d.join(", ")+"}"},"Reference to undefined node '"+h+"' as dependency of '"+d+"'"+(a.hasOwnProperty("context")?" in context "+b(a.context):"");})})}function x(){c(e,function(a,d){"event"!==a.type||a.isWiredUp||(a.wireup(function(a){p(d,function(d){d(a)})}),a.isWiredUp=!0)})}function p(a,d){if(e.hasOwnProperty(a))y[e[a].type](a,d);else throw"Cannot yield: '"+a+"' is not defined";}function t(a,d,b){void 0===b&&(b=[]);a.length?p(a[0],function(c){t(a.slice(1),d,b.concat([c]))}):d(b)}
function u(a,d){var b=e[a]["in"].map(function(d){return m(d,e[a].scope)});t(b,d)}function r(a,d){z[e[a].type](a,d)}function s(a){r(a,function(){})}var q=["result","respond","define","type","event"],e={};Cable._debug=function(){return e};Cable.each=c;Cable.define=function(a,d){d=l({reify:!0,wireup:!0,scope:{chain:[]}},d);c(a,function(a,c){if(/^_/.test(c))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=q.indexOf(c))throw"Illegal definition: "+c+" is a reserved word.";if(e.hasOwnProperty(c))throw"Illegal definition: "+
c+" is already defined.";var f=null,f=a.hasOwnProperty("type")?a.type:k(a)?-1!=b(a).indexOf("result")||-1!=b(a).indexOf("respond")?"synthetic":"effect":"sub";if(v.hasOwnProperty(f))v[f](c,a,d.scope);else if("sub"!==f&&"reference"!==f)throw"Illegal definiton: could not determine meaning of "+c;});(d.reify||d.wireup)&&n(function(){d.reify&&w();d.wireup&&x()})};var v={data:function(a,d,b){e[a]={type:"data",value:d.value,"in":[],out:[],helpers:d.helpers?d.helpers:{},scope:b}},synthetic:function(a,d,c){-1!=
b(d).indexOf("respond")?e[a]={type:"synthetic",fn:d,value:null,invoked:!1,"in":f(d,d.context),out:[],resultIndex:b(d).indexOf("respond"),scope:c,coalesce:!1}:e[a]={type:"synthetic",fn:d,value:null,invoked:!1,"in":f(d,d.context),out:[],resultIndex:b(d).indexOf("result"),scope:c,coalesce:!0}},effect:function(a,d,b){e[a]={type:"effect",fn:d,"in":f(d,d.context),out:[],scope:b}},event:function(a,d,b){e[a]={type:"event",value:d.defaultValue,wireup:d.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:b}},
library:function(a,d,b){e[a]={type:"library",path:d.path,shim:d.shim,handle:null,loaded:!1,scope:b}},sub:function(a,d,b){var e={};c(d,function(a,d){});c(d,function(d,b){e["main"===b?a:a+"_"+b]=d});Cable.define(e,{reify:!1,wireup:!1,scope:{chain:b.chain.concat([a])}})},module:function(a,b,c){e[a]={type:"module",url:b.url,scope:c}}},y={data:function(a,b){var f=function(){if(!arguments.length)return e[a].value;arguments[0]!=e[a].value&&(e[a].value=arguments[0],e[a].out.forEach(s))};c(e[a].helpers,function(a,
b){f[b]=function(){return a.apply(f,arguments)}});b(f)},synthetic:function(a,b){e[a].invoked?b(function(){return e[a].value}):r(a,function(){})},effect:function(){},event:function(a,b){b(function(){if(!arguments.length)return e[a].value;arguments[0]==e[a].value&&e[a].coalesce||(e[a].invoked=!0,e[a].value=arguments[0],e[a].out.forEach(s))})},library:function(a,b){e[a].loaded?b(e[a].handle):r(a,function(){p(a,b)})}};Cable.yield=p;var z={data:p.data,event:p.event,synthetic:function(a,b){u(a,function(c){c.splice(e[a].resultIndex,
0,function(c){e[a].invoked=!0;e[a].value==c&&e[a].coalesce||(e[a].value=c,e[a].out.forEach(s));b()});e[a].fn.apply({},c)})},effect:function(a,b){u(a,function(c){e[a].fn.apply({},c);b()})},library:function(a,b){if(e[a].loaded)b();else{var c=function(){var b=arguments.length-1;k(arguments[b])?e[a].handle=arguments[b]():e[a].handle=arguments[b];e[a].loaded=!0};c.amd={};var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var f=this.responseText;e[a].shim&&
(f=["define(function() {",f,"\nreturn ",e[a].shim,"; });"].join(""));window.define=c;eval(f);delete window.define;"$"===a&&$&&$.noConflict&&$.noConflict();b()}};f.open("get",e[a].path,!0);f.send()}}};Cable.initialize=function(a,b){"synthetic"===e[a].type&&(e[a].value=b,e[a].invoked=!0)}})();Cable.withArgs=function(c,b){b.argAliases=c;return b};Cable.data=function(c,b){var f={type:"data",value:c};b&&(f.helpers=b);return f};Cable.define({init:{type:"event",wireup:function(c){c(new Date)}}},{reify:!1,wireup:!1});
Cable.list=function(c){return{array:Cable.data(c),main:Cable.data({type:"initialize",array:c},{insertAt:function(b,c){this({type:"insert",index:b,element:c})},prepend:function(b){this({type:"insert",index:0,element:b})},append:function(b){this({type:"insert",index:-1,element:b})},updateAt:function(b,c){this({type:"update",index:b,updates:c})},deleteAt:function(b){this({type:"delete",index:b})}}),updater:Cable.withArgs(["main","_array"],function(b,c){var g=b(),k=c().slice(0);if("insert"===g.type)k.splice(0<=
g.index?g.index:k.length,0,g.element);else if("update"===g.type)for(var l in g.updates)g.updates.hasOwnProperty(l)&&(k[g.index][l]=g.updates[l]);else"delete"===g.type&&k.splice(g.index,1);c(k)})}};
Cable.interval=function(c,b){if(c.substring){var f=["ref","_pid"];b&&(f=f.concat("init"));return{ref:Cable.reference(c),pid:Cable.data(-1),main:Cable.withArgs(f,function(b,c,f){clearInterval(c());b=setInterval(function(){f(new Date)},b());c(b)})}}return{type:"event",defaultValue:new Date,wireup:function(f){setInterval(function(){f(new Date)},c);b&&f(new Date)}}};Cable.library=function(c,b){return{type:"library",path:c,shim:b}};Cable.module=function(c){return{type:"module",url:c}};
Cable.pack=function(c){var b=function(c){for(var g={},k=1;k<b.argAliases.length;++k)g[b.argAliases[k]]=arguments[k]();c(g)};c=c.slice(0);c.splice(0,0,"result");b.argAliases=c;return b};Cable.counter=function(){return Cable.data(-1,{next:function(){var c=this()+1;this(c);return c}})};Cable.event=function(c,b,f,g){return{type:"event",coalesce:!1,wireup:function(k){Cable.yield("$",function(l){if("document"===c&&"ready"===b)l(document).ready(k);else{var n=function(){var b=null,g=l(c);f||(f="time");"value"===f?(b=g.val(),g.is("[type='number']")&&(b=parseFloat(b))):"time"===f?b=new Date:/^data-[-_a-zA-Z0-9]+/.test(f)?b=g.attr(f):":checked"===f&&(b=g.is(":checked"));k(b)},m;"key-return"===b?(b="keyup",m=function(b){13===b.keyCode&&n()}):m=n;l(document).on(b,c,m);g&&n()}})}}};
Cable.textbox=function(c){return{type:"event",wireup:function(b){Cable.yield("$",function(f){var g=f(c),k=function(){return g.is("[type='number']")?parseFloat(g.val()):g.val()};g.on("change keyup",function(){b(k())});b(k())})}}};Cable.checkbox=function(c){return Cable.event(c,"change",":checked",!0)};Cable.button=function(c){return{type:"event",wireup:function(b){Cable.yield("$",function(f){f(c).on("click",function(){b(new Date)})})}}};
Cable.returnKey=function(c){return{type:"event",wireup:function(b){Cable.yield("$",function(f){f(c).on("keyup",function(c){13===c.keyCode&&b(new Date)})})}}};Cable.template=function(c,b){var f=(b.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(b){return b.replace(/\{|\}/g,"")});return{properties:Cable.pack(f),main:Cable.withArgs(["properties","$"],function(g,k){function l(b){return"number"===typeof b?b.toFixed(2):b}for(var n=b,m=0;m<f.length;++m)n=n.replace("{{"+f[m]+"}}",l(g()[f[m]]));k(c).html(n)})}};
Cable.json=function(c){return{url:c,main:Cable.withArgs(["$","url","result"],function(b,c,g){var k=/^http/.test(c())&&!/callback=/.test(c());b.ajax({dataType:"json",url:c(),crossDomain:!!k,success:function(b){g(b)}})})}};Cable.text=function(c){return Cable.withArgs(["$","result"],function(b,f){b.ajax({url:c,dataType:"text",success:function(b){f(b)}})})};
