/* cablejs: By Wyatt Allen, MIT Licenced */
var Cable={};
(function(){function d(a,c){for(var g in a)a.hasOwnProperty(g)&&c(a[g],g)}function b(a){return a.argAliases?a.argAliases:(a+"").match(/^function(\s+\S*)?\(([^)]+)\)/)[2].split(",").map(function(a){return a.replace(/(^\s+)|(\s+$)/g,"")})}function f(a,c){return b(a).filter(function(a){return-1==q.indexOf(a)}).map(function(a){return a.replace(/^_/,"")})}function h(a,c){return b(a).filter(function(a){return-1==q.indexOf(a)&&"_"!=a[0]})}function k(a){var c={};return a&&"[object Function]"===c.toString.call(a)}
function m(a,c){if(c){var g={};d(a,function(a,b){g[b]=c.hasOwnProperty(b)?c[b]:a});return g}return a}function l(a,c){for(var g=c.chain,b="main"===a?"":"_"+a,d=[],f=0;f<g.length;++f)d.push(g.slice(0,g.length-f).join("_")+b);d.push(a);for(g=0;g<d.length;++g)if(e.hasOwnProperty(d[g]))return d[g];return null}function p(){d(e,function(a){a.out=[]});d(e,function(a,c){a.fn&&h(a.fn,a.context).forEach(function(g){var b=l(g,a.scope);if(b)e[b].out.push(c);else throw b=function(a){var c=[];d(a.references,function(a,
g){c.push("'"+g+"' ==> '"+a+"'")});return"named '"+a.name+"' and references {"+c.join(", ")+"}"},"Reference to undefined node '"+g+"' as dependency of '"+c+"'"+(a.hasOwnProperty("context")?" in context "+b(a.context):"");})})}function w(){d(e,function(a,c){"event"!==a.type||a.isWiredUp||(a.wireup(function(a){n(c,function(c){c(a)})}),a.isWiredUp=!0)})}function n(a,c){if(e.hasOwnProperty(a))x[e[a].type](a,c);else throw"Cannot yield: '"+a+"' is not defined";}function s(a,c,g){void 0===g&&(g=[]);a.length?
n(a[0],function(b){s(a.slice(1),c,g.concat([b]))}):c(g)}function t(a,c){var g=e[a]["in"].map(function(c){return l(c,e[a].scope)});s(g,c)}function u(a,c){y[e[a].type](a,c)}function r(a){u(a,function(){})}var q=["result","respond","define","type","event"],e={};Cable.define=function(a,c){c=m({reify:!0,wireup:!0,scope:{chain:[]}},c);d(a,function(a,d){if(/^_/.test(d))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=q.indexOf(d))throw"Illegal definition: "+d+" is a reserved word.";
if(e.hasOwnProperty(d))throw"Illegal definition: "+d+" is already defined.";var f=null,f=a.hasOwnProperty("type")?a.type:k(a)?-1!=b(a).indexOf("result")||-1!=b(a).indexOf("respond")?"synthetic":"effect":"sub";if(v.hasOwnProperty(f))v[f](d,a,c.scope);else if("sub"!==f&&"reference"!==f)throw"Illegal definiton: could not determine meaning of "+d;});c.reify&&p();c.wireup&&w()};var v={data:function(a,c,b){e[a]={type:"data",value:c.value,"in":[],out:[],helpers:c.helpers?c.helpers:{},scope:b}},synthetic:function(a,
c,d){-1!=b(c).indexOf("respond")?e[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":f(c,c.context),out:[],resultIndex:b(c).indexOf("respond"),scope:d,coalesce:!1}:e[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":f(c,c.context),out:[],resultIndex:b(c).indexOf("result"),scope:d,coalesce:!0}},effect:function(a,c,b){e[a]={type:"effect",fn:c,"in":f(c,c.context),out:[],scope:b}},event:function(a,c,b){e[a]={type:"event",value:c.defaultValue,wireup:c.wireup,isWiredUp:!1,"in":[],out:[],scope:b}},
library:function(a,c,b){e[a]={type:"library",path:c.path,shim:c.shim,handle:null,loaded:!1,scope:b}},sub:function(a,c,b){var f={};d(c,function(a,c){});d(c,function(c,b){f["main"===b?a:a+"_"+b]=c});Cable.define(f,{reify:!1,wireup:!1,scope:{chain:b.chain.concat([a])}})}},x={data:function(a,c){var b=function(){if(!arguments.length)return e[a].value;arguments[0]!=e[a].value&&(e[a].value=arguments[0],e[a].out.forEach(r))};d(e[a].helpers,function(a,c){b[c]=function(){return a.apply(b,arguments)}});c(b)},
synthetic:function(a,c){c(function(){return e[a].value})},effect:function(){},event:function(a,c){c(function(){if(!arguments.length)return e[a].value;arguments[0]==e[a].value&&e[a].coalesce||(e[a].value=arguments[0],e[a].out.forEach(r))})},library:function(a,c){e[a].loaded?c(e[a].handle):u(a,function(){n(a,c)})}};Cable.yield=n;var y={data:n.data,event:n.event,synthetic:function(a,c){t(a,function(b){b.splice(e[a].resultIndex,0,function(b){e[a].value==b&&e[a].coalesce||(e[a].value=b,e[a].invoked=!0,
e[a].out.forEach(r));c()});e[a].fn.apply({},b)})},effect:function(a,c){t(a,function(b){e[a].fn.apply({},b);c()})},library:function(a,c){if(e[a].loaded)c();else{var b=function(){var c=arguments.length-1;k(arguments[c])?e[a].handle=arguments[c]():e[a].handle=arguments[c];e[a].loaded=!0};b.amd={};var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var d=this.responseText;e[a].shim&&(d=["define(function() {",d,"\nreturn ",e[a].shim,"; });"].join(""));window.define=
b;eval(d);delete window.define;"$"===a&&$&&$.noConflict&&$.noConflict();c()}};d.open("get",e[a].path,!0);d.send()}}}})();Cable.data=function(d,b){var f={type:"data",value:d};b&&(f.helpers=b);return f};Cable.event=function(d,b,f,h){return{type:"event",coalesce:!1,wireup:function(k){Cable.yield("$",function(m){if("document"===d&&"ready"===b)m(document).ready(k);else{var l=function(){var b=null,h=m(d);f||(f="time");"value"===f?b=h.val():"time"===f?b=new Date:/^data-[-_a-zA-Z0-9]+/.test(f)&&(b=h.attr(f));k(b)},p;"key-return"===b?(b="keyup",p=function(b){13===b.keyCode&&l()}):p=l;m(document).on(b,d,p);h&&l()}})}}};
Cable.returnKey=function(d){return{type:"event",wireup:function(b){Cable.yield("$",function(f){f(d).on("keyup",function(d){13===d.keyCode&&b(new Date)})})}}};Cable.define({init:{type:"event",wireup:function(d){d(new Date)}}},{reify:!1,wireup:!1});
Cable.list=function(d){return{array:Cable.data(d),main:Cable.data({index:0,howMany:0,replacement:d},{splice:function(b,d,h){this({index:b,howMany:d,replacement:h})},prepend:function(b){this({index:0,howMany:0,replacement:[b]})},append:function(b){this({index:-1,howMany:0,replacement:[b]})},updateAt:function(b,d){this({index:b,howMany:1,replacement:[d]})}}),updater:function(b,d){var h=b(),k=d().slice(0);0<=h.index?k.splice(h.index,h.howMany,h.replacement):k.splice(k.length-h.index,h.howMany,h.replacement);
d(k)}}};Cable.interval=function(d){return d.substring?{ref:Cable.reference(d),pid:Cable.data(-1),main:function(b,d,h){clearInterval(d());b=setInterval(function(){h(new Date)},b());d(b)}}:{type:"event",defaultValue:new Date,wireup:function(b){setInterval(function(){b(new Date)},d)}}};Cable.reference=function(d){return{type:"reference",referenceName:d}};Cable.library=function(d,b){return{type:"library",path:d,shim:b}};
Cable.template=function(d,b){var f=(b.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(b){return b.replace(/\{|\}/g,"")});return{properties:Cable.pack(f),main:function(h,k){for(var m=b,l=0;l<f.length;++l)m=m.replace("{{"+f[l]+"}}",h()[f[l]]);k(d).html(m)}}};Cable.pack=function(d){var b=function(d){for(var h={},k=1;k<b.argAliases.length;++k)h[b.argAliases[k]]=arguments[k]();d(h)};d=d.slice(0);d.splice(0,0,"result");b.argAliases=d;return b};
Cable.counter=function(){return Cable.data(-1,{next:function(){var d=this()+1;this(d);return d}})};Cable.json=function(d){return{url:d,main:function(b,d,h){var k=/^http/.test(d())&&!/callback=/.test(d());b.ajax({dataType:"json",url:d(),crossDomain:!!k,success:function(b){h(b)}})}}};
