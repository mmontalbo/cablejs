<html>
  <head>
    <title>2048 Cable</title>
    <link 
      rel="stylesheet" 
      href="../bower_components/bootstrap/dist/css/bootstrap.min.css" />
    <link 
      rel="stylesheet" 
      href="style.css" />
  </head>
  <body>
    <div id="main">
      <div id="grid"></div>
    </div>
    <script src="../../dist/cable.min.js"></script>
    <script>
      Cable.define({
        $:Cable.library("../bower_components/jquery/dist/jquery.min.js"),

        render:{
          jade:Cable.library("../bower_components/jade/jade.js"),
          grid:Cable.text("grid.jade"),
          main:function($, jade, grid, state, init) {
            $("#grid").html(jade.render(grid(), state()));
          }
        },

        input:function($, define) {
          define(function(event) {
            $(document).on("keyup", function(e) {
              switch (e.which) {
                case 37: event("west");   break;
                case 38: event("north");  break;
                case 39: event("east");   break;
                case 40: event("south");  break;
              }
            });
          });
        },

        game:Cable.library("game.js"),
        state:Cable.data({ last:{ created:[], moved:[], merged:[] } }),

        last:{
          create:function(state, result) { result(state().last.created); },
          move:function(state, result) { result(state().last.moved); },
          merge:function(state, result) { result(state().last.merged); }
        },

        setup:function(init, game, _state) {
          _state(game.initialize());
        },

        move:function(game, _state, input) {
          _state(game.move(_state(), input()));
        }

      });
    </script>
  </body>
</html>
