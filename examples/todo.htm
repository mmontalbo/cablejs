<html>
  <head>
    <title>Cable</title>
    <style>
      #list li.done {
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <ul id="list"></lul>

    <div id="umm"></div>

    <input id="new" type="text" value="Pay dem bills" />

    <input type="button" value="Add" id="add-button" />
    <!-- <div id="display"></div> -->

    <ul id="list-display"></ul>

    <script src="../src/core.js"></script>
    <script src="../src/helpers.js"></script>
    <script>
      Cable.define({
        $:Cable.library("../lib/jquery-1.10.2.min.js"),
        mustache:Cable.library("../lib/mustache.js"),

        todoList:Cable.list([ "Do the laundry" ]),

        textbox:Cable.event("#new", "change keyup", "value", true),
        textboxEnter:Cable.returnKey("#new"),
        button:Cable.event("#add-button", "click", "time"),

        add:function(button, textboxEnter, _textbox, _todoList, $) {
          if (_textbox().length) {
            _todoList.append(_textbox());
            $("#new").val("").trigger("change");
          }
        },

        itemCounter:Cable.counter(),

        displayList:function(init, todoList, $, _itemCounter) {
          var splice = todoList();

          // Remove elements to be removed:
          var toRemove = [];
          for (var idx = 0; idx < splice.howMany.length; ++idx) {
            toRemove.push("ul#list-display li:eq(" + (splice.index + idx) + ")");
          }
          $(toRemove.join(", ")).remove();

          //  Add the new elements:
          for (var idx = 0; idx < splice.replacement.length; ++idx) {
            var o = $("<li/>")
              .text(splice.replacement[idx])
              .attr("data-id", _itemCounter.next());

            if (splice.index === -1 || !$("ul#list-display li").length) {
              $("ul#list-display").append(o);
            }
            else {
              $("ul#list-display li:eq(" + (splice.index + idx) + ")").after(o);
            }
          }
        },

        finishTask:{
          type:"event",
          wireup:function(fn) {
            Cable.yield("$", function($) {
              $(document).on("click", "#list li", function(evt) { 
                console.log("triggering");
                fn($(evt.target).attr("data-id")); 
              });
            });
          }
        },

        wantToFinish:function($, finishTask) { 
          $("#list li[data-id='" + finishTask() + "']").toggleClass("done");
        }
      });
    </script>
  </body>
</html>
