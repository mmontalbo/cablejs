<html>
  <head>
    <title>Cable</title>
    <style>
      html, body { background: #ddd; }
      #main { 
        background: #fff; 
        width: 400px; 
        margin: 20px auto;
        padding: 20px;
        border-radius: 15px;
      }
      #new { width:350px; }
      #list li.done { text-decoration: line-through; }
    </style>
  </head>
  <body>
    <div id="main">
      <input id="new" type="text" value="Pay dem bills" />
      <input type="button" value="Add" id="add-button" />
      <ul id="list"></ul>
    </div>

    <script src="../src/core.js"></script>
    <script src="../src/helpers.js"></script>
    <script>
      Cable.define({
        $:Cable.library("../lib/jquery-1.10.2.min.js"),
        mustache:Cable.library("../lib/mustache.js"),

        todoList:Cable.list([ "Do the laundry" ]),

        textbox:Cable.event("#new", "change keyup", "value", true),
        textboxEnter:Cable.returnKey("#new"),
        button:Cable.event("#add-button", "click", "time"),

        add:function(button, textboxEnter, _textbox, _todoList, $) {
          if (_textbox().length) {
            _todoList.append(_textbox());
            $("#new").val("").trigger("change");
          }
        },

        itemCounter:Cable.counter(),

        displayList:function(init, todoList, $, _itemCounter) {
          var splice = todoList();

          // Remove elements to be removed:
          var toRemove = [];
          for (var idx = 0; idx < splice.howMany.length; ++idx) {
            toRemove.push("ul#list li:eq(" + (splice.index + idx) + ")");
          }
          $(toRemove.join(", ")).remove();

          //  Add the new elements:
          for (var idx = 0; idx < splice.replacement.length; ++idx) {
            var o = $("<li/>")
              .text(splice.replacement[idx])
              .attr("data-id", _itemCounter.next());

            if (splice.index === -1 || !$("ul#list li").length) {
              $("ul#list").append(o);
            }
            else {
              $("ul#list li:eq(" + (splice.index + idx) + ")").after(o);
            }
          }
        },

        taskClicked:{
          type:"event",
          wireup:function(fn) {
            Cable.yield("$", function($) {
              $(document).on("click", "ul#list li", function(evt) { 
                fn($(evt.target).attr("data-id")); 
              });
            });
          }
        },

        finishTask:function($, taskClicked) { 
          $("#list li[data-id='" + taskClicked() + "']").toggleClass("done");
        }
      });
    </script>
  </body>
</html>
