/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-04-01T19:37:06.585Z              .
.......................................*/
'use strict';var Cable={};
(function(){function a(b,d){for(var g in b)b.hasOwnProperty(g)&&d(b[g],g)}function e(b){return b.argAliases?b.argAliases:(b+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(b){return b.replace(/(^\s+)|(\s+$)/g,"")})}function c(b,d){return e(b).filter(function(b){return-1==r.indexOf(b)}).map(function(b){return b.replace(/^_/,"")})}function k(b,d){return e(b).filter(function(b){return-1==r.indexOf(b)&&"_"!=b[0]})}function h(b){var d={};return b&&"[object Function]"===d.toString.call(b)}
function l(b,d){if(d){var g={};a(b,function(b,f){g[f]=d.hasOwnProperty(f)?d[f]:b});return g}return b}function n(b){function d(g){if(g.length){var e=g[0],a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b="("+this.responseText+")";delete f[e];var a={};try{a[e]=eval(b)}catch(c){throw"Failed to load module '"+e+"': "+c;}Cable.define(a,{reify:!1,wireup:!1});d(g.slice(1))}};a.open("get",f[e].url,!0);a.send()}else b()}var g=[],e;for(e in f)f.hasOwnProperty(e)&&
"module"===f[e].type&&g.push(e);d(g)}function m(b,d){for(var g=d.chain,e="main"===b?"":"_"+b,a=[],c=0;c<g.length;++c)a.push(g.slice(0,g.length-c).join("_")+e);a.push(b);for(g=0;g<a.length;++g)if(f.hasOwnProperty(a[g]))return"alias"===f[a[g]].type?(a=f[a[g]],m(a.reference,a.scope)):a[g];return null}function v(){a(f,function(b){b.out=[]});a(f,function(b,d){b.fn&&k(b.fn,b.context).forEach(function(g){var a=m(g,b.scope);if(a)f[a].out.push(d);else throw"Reference to undefined node '"+g+"' as dependency of '"+
d+"'";})})}function x(){a(f,function(b,d){if("subdefinition"===b.type)if(y(d))s(d,function(g){g.splice(b.defineIndex,0,function(g){var a={};a[d]=g;Cable.define(a,{scope:b.scope})});delete f[d];b.fn.apply(window,g)});else throw"Illegal subdefinition: "+d+". Subdefs must depend only on libraries";})}function z(){a(f,function(b,d){if("event"===b.type&&!b.isWiredUp){var g=function(b){p(d,function(d){d(b)})};g.setDefault=function(d){console.log("setting default",d);b.value=d};b.wireup(g);b.isWiredUp=!0}})}
function p(b,d){if(f.hasOwnProperty(b))A[f[b].type](b,d);else throw"Cannot generate: '"+b+"' is not defined";}function q(b,d,g,a){void 0===g&&(g=[]);b.length?a&&a.hasOwnProperty(b[0])?q(b.slice(1),d,g.concat([a[b[0]]]),a):p(b[0],function(f){q(b.slice(1),d,g.concat([f]),a)}):d(g)}function s(b,d){var g=f[b]["in"].map(function(d){return m(d,f[b].scope)});q(g,d)}function t(b,d){B[f[b].type](b,d)}function u(b){t(b,function(){})}function y(b){return f[b]["in"].map(function(d){return"library"===f[m(d,f[b].scope)].type}).reduce(function(b,
g){return b&&g})}var r=["result","respond","type","event","define"],f={};Cable._debug=function(){return f};Cable.each=a;Cable.define=function(b,d){d=l({reify:!0,wireup:!0,scope:{chain:[]}},d);a(b,function(b,a){if(/^_/.test(a))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=r.indexOf(a))throw"Illegal definition: "+a+" is a reserved word.";if(f.hasOwnProperty(a))throw"Illegal definition: "+a+" is already defined.";var c=null;b.hasOwnProperty("type")?c=b.type:h(b)?(c=b,-1!=e(c).indexOf("result")||
-1!=e(c).indexOf("respond")?c="synthetic":-1!==e(b).indexOf("define")?c="subdefinition":(c=e(b),1===c.length&&"event"===c[0]?(c="event",b={type:"event",wireup:b}):c="effect")):c="scope";if(w.hasOwnProperty(c))w[c](a,b,d.scope);else throw"Illegal definiton: could not determine meaning of "+a;});(d.reify||d.wireup)&&n(function(){d.reify&&(v(),x(),v());d.wireup&&z()})};var w={data:function(b,d,a){f[b]={type:"data",value:d.value,"in":[],out:[],helpers:d.helpers?d.helpers:{},scope:a}},synthetic:function(b,
d,a){-1!=e(d).indexOf("respond")?f[b]={type:"synthetic",fn:d,value:null,invoked:!1,"in":c(d,d.context),out:[],resultIndex:e(d).indexOf("respond"),scope:a,coalesce:!1}:f[b]={type:"synthetic",fn:d,value:null,invoked:!1,"in":c(d,d.context),out:[],resultIndex:e(d).indexOf("result"),scope:a,coalesce:!0}},effect:function(b,d,a){f[b]={type:"effect",fn:d,"in":c(d,d.context),out:[],scope:a}},event:function(b,d,a){f[b]={type:"event",value:d.defaultValue,wireup:d.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],
scope:a}},library:function(b,d,a){f[b]={type:"library",path:d.path,shim:d.shim,handle:null,loaded:!1,scope:a}},scope:function(b,d,f){var e={};a(d,function(d,a){e["main"===a?b:b+"_"+a]=d});Cable.define(e,{reify:!1,wireup:!1,scope:{chain:f.chain.concat([b.replace(/^.+_/,"")])}})},subdefinition:function(b,d,a){f[b]={type:"subdefinition",in:c(d),fn:d,scope:a,defineIndex:e(d).indexOf("define")}},module:function(b,a,e){f[b]={type:"module",url:a.url,scope:e}},alias:function(b,a,e){f[b]={type:"alias",reference:a.reference,
scope:e}}},A={data:function(b,d){var e=function(){if(!arguments.length)return f[b].value;arguments[0]!=f[b].value&&(f[b].value=arguments[0],f[b].out.forEach(u))};a(f[b].helpers,function(b,a){e[a]=function(){return b.apply(e,arguments)}});d(e)},synthetic:function(b,a){f[b].invoked?a(function(){return f[b].value}):t(b,function(){})},effect:function(){},event:function(b,a){a(function(){if(!arguments.length)return f[b].value;arguments[0]==f[b].value&&f[b].coalesce||(f[b].invoked=!0,f[b].value=arguments[0],
f[b].out.forEach(u))})},library:function(b,a){f[b].loaded?a(f[b].handle):t(b,function(){p(b,a)})}},B={data:p.data,event:p.event,synthetic:function(b,a){s(b,function(e){e.splice(f[b].resultIndex,0,function(e){f[b].invoked=!0;f[b].value==e&&f[b].coalesce||(f[b].value=e,f[b].out.forEach(u));a()});f[b].fn.apply({},e)})},effect:function(b,a){s(b,function(e){f[b].fn.apply({},e);a()})},library:function(b,a){if(f[b].loaded)a();else{var e=function(){var a,e,d={},c=0;arguments[c].substring&&c++;a=arguments[c].splice?
arguments[c++]:["require","exports","module"];if(h(arguments[c])){var g=arguments[c];e=-1!==a.indexOf("exports")?function(){var b=g.apply(window,arguments);return void 0!==b?b:d}:g}else{var k=arguments[c];e=function(){return k}}q(a,function(a){f[b].handle=e.apply(window,a);f[b].loaded=!0},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";},exports:d,module:null})};e.amd={};var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===this.readyState&&200===
this.status){var c=this.responseText;f[b].shim&&(c=["define(function() {",c,"\nreturn ",f[b].shim,"; });"].join(""));window.define=e;eval(c);delete window.define;"$"===b&&$&&$.noConflict&&$.noConflict();a()}};c.open("get",f[b].path,!0);c.send()}}};Cable.initialize=function(b,a){"synthetic"===f[b].type&&(f[b].value=a,f[b].invoked=!0)}})();Cable.withArgs=function(a,e){e.argAliases=a;return e};Cable.data=function(a,e){var c={type:"data",value:a};e&&(c.helpers=e);return c};Cable.define({init:Cable.withArgs(["event"],function(a){a(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(a){return{array:Cable.data(a),main:Cable.data({type:"initialize",array:a},{insertAt:function(a,c){this({type:"insert",index:a,element:c})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,c){this({type:"update",index:a,updates:c})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,c){var k=a(),h=c().slice(0);if("insert"===k.type)h.splice(0<=
k.index?k.index:h.length,0,k.element);else if("update"===k.type)for(var l in k.updates)k.updates.hasOwnProperty(l)&&(h[k.index][l]=k.updates[l]);else"delete"===k.type&&h.splice(k.index,1);c(h)})}};
Cable.interval=function(a,e){if(a.substring){var c=[a,"_pid"];e&&(c=c.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(c,function(a,e,c){clearInterval(e());a=setInterval(function(){c(new Date)},a());e(a)})}}return{type:"event",defaultValue:new Date,wireup:function(c){setInterval(function(){c(new Date)},a);e&&c(new Date)}}};Cable.library=function(a,e){return{type:"library",path:a,shim:e}};Cable.module=function(a){return{type:"module",url:a}};
Cable.pack=function(a){var e=function(a){for(var k={},h=1;h<e.argAliases.length;++h)k[e.argAliases[h]]=arguments[h]();a(k)};a=a.slice(0);a.splice(0,0,"result");e.argAliases=a;return e};Cable.counter=function(){return Cable.data(-1,{next:function(){var a=this()+1;this(a);return a}})};Cable.alias=function(a){return{type:"alias",reference:a}};Cable.textbox=function(a){return Cable.withArgs(["$","define"],function(e,c){c(Cable.withArgs(["event"],function(c){var h=e(a),l=function(){return h.is("[type='number']")?parseFloat(h.val()):h.val()};h.on("change keyup",function(){c(l())});c(l())}))})};Cable.checkbox=function(a){return Cable.withArgs(["$","define"],function(e,c){var k=e(a);c(Cable.withArgs(["event"],function(a){k.on("change",function(){a(k.is(":checked"))});a(k.is(":checked"))}))})};
Cable.button=function(a){return Cable.withArgs(["$","define"],function(e,c){c(Cable.withArgs(["event"],function(c){e(a).on("click",function(){c(new Date)})}))})};Cable.returnKey=function(a){return Cable.withArgs(["$","define"],function(e,c){c({type:"event",wireup:function(c){e(a).on("keyup",function(a){13===a.keyCode&&c(new Date)})}})})};
Cable.template=function(a,e){var c=(e.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(c),main:Cable.withArgs(["properties","$"],function(k,h){function l(a){return"number"===typeof a?a.toFixed(2):a}for(var n=e,m=0;m<c.length;++m)n=n.replace("{{"+c[m]+"}}",l(k()[c[m]]));h(a).html(n)})}};
Cable.json=function(a){return{url:a,main:Cable.withArgs(["$","url","result"],function(a,c,k){var h=/^http/.test(c())&&!/callback=/.test(c());a.ajax({dataType:"json",url:c(),crossDomain:!!h,success:function(a){k(a)}})})}};Cable.text=function(a){return Cable.withArgs(["$","result"],function(e,c){e.ajax({url:a,dataType:"text",success:function(a){c(a)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(a,e){var c={};a("[cable]").each(function(e,h){a(h).is(":text")?c[h.id]=Cable.textbox("#"+h.id):c[h.id]=Cable.template("#"+h.id,h.innerText)});e(c)})};
