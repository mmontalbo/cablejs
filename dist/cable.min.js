/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-04-08T21:28:44.505Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function a(b,c){for(var g in b)b.hasOwnProperty(g)&&c(b[g],g)}function d(b){return b.argAliases?b.argAliases:(b+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(b){return b.replace(/(^\s+)|(\s+$)/g,"")})}function e(b,c){return d(b).filter(function(b){return-1==r.indexOf(b)}).map(function(b){return b.replace(/^_/,"")})}function h(b,c){return d(b).filter(function(b){return-1==r.indexOf(b)&&"_"!=b[0]})}function k(b){var c={};return b&&"[object Function]"===c.toString.call(b)}
function l(b,c){if(c){var g={};a(b,function(b,f){g[f]=c.hasOwnProperty(f)?c[f]:b});return g}return b}function n(b){function c(g){if(g.length){var d=g[0],a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b="("+this.responseText+")";delete f[d];var a={};try{a[d]=eval(b)}catch(e){throw"Failed to load module '"+d+"': "+e;}Cable.define(a,{reify:!1,wireup:!1});c(g.slice(1))}};a.open("get",f[d].url,!0);a.send()}else b()}var g=[],d;for(d in f)f.hasOwnProperty(d)&&
"module"===f[d].type&&g.push(d);c(g)}function m(b,c){for(var g=c.chain,d="main"===b?"":"_"+b,a=[],e=0;e<g.length;++e)a.push(g.slice(0,g.length-e).join("_")+d);a.push(b);for(g=0;g<a.length;++g)if(f.hasOwnProperty(a[g]))return"alias"===f[a[g]].type?(a=f[a[g]],m(a.reference,a.scope)):a[g];return null}function v(){a(f,function(b){b.out=[]});a(f,function(b,c){b.fn&&h(b.fn,b.context).forEach(function(g){var a=m(g,b.scope);if(a)f[a].out.push(c);else throw"Reference to undefined node '"+g+"' as dependency of '"+
c+"'";})})}function x(){a(f,function(b,c){if("subdefinition"===b.type)if(y(c))s(c,function(g){g.splice(b.defineIndex,0,function(g){var a={};a[c]=g;Cable.define(a,{scope:b.scope})});delete f[c];b.fn.apply(window,g)});else throw"Illegal subdefinition: "+c+". Subdefs must depend only on libraries";})}function z(){a(f,function(b,c){if("event"===b.type&&!b.isWiredUp){var g=function(b){p(c,function(c){c(b)})};g.setDefault=function(c){b.value=c};b.wireup(g);b.isWiredUp=!0}})}function p(b,c){if(f.hasOwnProperty(b))A[f[b].type](b,
c);else throw"Cannot generate: '"+b+"' is not defined";}function q(b,c,g,a){void 0===g&&(g=[]);b.length?a&&a.hasOwnProperty(b[0])?q(b.slice(1),c,g.concat([a[b[0]]]),a):p(b[0],function(f){q(b.slice(1),c,g.concat([f]),a)}):c(g)}function s(b,c){var g=f[b]["in"].map(function(c){return m(c,f[b].scope)});q(g,c)}function t(b,c){B[f[b].type](b,c)}function u(b){t(b,function(){})}function y(b){return f[b]["in"].map(function(c){return"library"===f[m(c,f[b].scope)].type}).reduce(function(b,g){return b&&g})}var r=
["result","respond","type","event","define"],f={};Cable._debug=function(){return f};Cable.each=a;Cable.define=function(b,c){c=l({reify:!0,wireup:!0,scope:{chain:[]}},c);a(b,function(b,a){if(/^_/.test(a))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=r.indexOf(a))throw"Illegal definition: "+a+" is a reserved word.";if(f.hasOwnProperty(a))throw"Illegal definition: "+a+" is already defined.";var e=null;b.hasOwnProperty("type")?e=b.type:k(b)?(e=b,-1!=d(e).indexOf("result")||
-1!=d(e).indexOf("respond")?e="synthetic":-1!==d(b).indexOf("define")?e="subdefinition":(e=d(b),1===e.length&&"event"===e[0]?(e="event",b={type:"event",wireup:b}):e="effect")):e="scope";if(w.hasOwnProperty(e))w[e](a,b,c.scope);else throw"Illegal definiton: could not determine meaning of "+a;});(c.reify||c.wireup)&&n(function(){c.reify&&(v(),x(),v());c.wireup&&z()})};var w={data:function(b,c,a){f[b]={type:"data",value:c.value,"in":[],out:[],helpers:c.helpers?c.helpers:{},scope:a}},synthetic:function(b,
c,a){-1!=d(c).indexOf("respond")?f[b]={type:"synthetic",fn:c,value:null,invoked:!1,"in":e(c,c.context),out:[],resultIndex:d(c).indexOf("respond"),scope:a,coalesce:!1}:f[b]={type:"synthetic",fn:c,value:null,invoked:!1,"in":e(c,c.context),out:[],resultIndex:d(c).indexOf("result"),scope:a,coalesce:!0}},effect:function(b,c,a){f[b]={type:"effect",fn:c,"in":e(c,c.context),out:[],scope:a}},event:function(b,c,a){f[b]={type:"event",value:c.defaultValue,wireup:c.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],
scope:a}},library:function(b,c,a){f[b]={type:"library",path:c.path,shim:c.shim,handle:null,loaded:!1,scope:a}},scope:function(b,c,f){var d={};a(c,function(c,a){d["main"===a?b:b+"_"+a]=c});c=f.chain.map(function(b){return b+"_"}).join("_");f=f.chain.concat([b.slice(c.length)]);Cable.define(d,{reify:!1,wireup:!1,scope:{chain:f}})},subdefinition:function(b,c,a){f[b]={type:"subdefinition",in:e(c),fn:c,scope:a,defineIndex:d(c).indexOf("define")}},module:function(b,a,d){f[b]={type:"module",url:a.url,scope:d}},
alias:function(b,a,d){f[b]={type:"alias",reference:a.reference,scope:d}}},A={data:function(b,c){var d=function(){if(!arguments.length)return f[b].value;arguments[0]!=f[b].value&&(f[b].value=arguments[0],f[b].out.forEach(u))};a(f[b].helpers,function(b,a){d[a]=function(){return b.apply(d,arguments)}});c(d)},synthetic:function(b,a){f[b].invoked?a(function(){return f[b].value}):t(b,function(){})},effect:function(){},event:function(b,a){a(function(){if(!arguments.length)return f[b].value;arguments[0]==
f[b].value&&f[b].coalesce||(f[b].invoked=!0,f[b].value=arguments[0],f[b].out.forEach(u))})},library:function(b,a){f[b].loaded?a(f[b].handle):t(b,function(){p(b,a)})}},B={data:p.data,event:p.event,synthetic:function(b,a){s(b,function(d){d.splice(f[b].resultIndex,0,function(d){f[b].invoked=!0;f[b].value==d&&f[b].coalesce||(f[b].value=d,f[b].out.forEach(u));a()});f[b].fn.apply({},d)})},effect:function(b,a){s(b,function(d){f[b].fn.apply({},d);a()})},library:function(b,a){if(f[b].loaded)a();else{var d=
function(){var d,e,g={},h=0;arguments[h].substring&&h++;d=arguments[h].splice?arguments[h++]:["require","exports","module"];if(k(arguments[h])){var l=arguments[h];e=-1!==d.indexOf("exports")?function(){var b=l.apply(window,arguments);return void 0!==b?b:g}:l}else{var m=arguments[h];e=function(){return m}}q(d,function(d){f[b].handle=e.apply(window,d);f[b].loaded=!0;a()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";},exports:g,module:null})};d.amd={};var e=
new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=this.responseText;f[b].shim&&(a=["define(function() {",a,"\nreturn ",f[b].shim,"; });"].join(""));window.define=d;try{eval(a)}catch(c){throw"Failed evaluating library "+b+": "+c;}delete window.define;"$"===b&&$&&$.noConflict&&$.noConflict()}};e.open("get",f[b].path,!0);e.send()}}};Cable.initialize=function(b,a){"synthetic"===f[b].type&&(f[b].value=a,f[b].invoked=!0)};Cable._private&&(Cable._private=
{getArgNames:d})})();Cable.withArgs=function(a,d){d.argAliases=a;return d};Cable.data=function(a,d){var e={type:"data",value:a};d&&(e.helpers=d);return e};Cable.define({init:Cable.withArgs(["event"],function(a){a(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(a){return{array:Cable.data(a),main:Cable.data({type:"initialize",array:a},{insertAt:function(a,e){this({type:"insert",index:a,element:e})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,e){this({type:"update",index:a,updates:e})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,e){var h=a(),k=e().slice(0);if("insert"===h.type)k.splice(0<=
h.index?h.index:k.length,0,h.element);else if("update"===h.type)for(var l in h.updates)h.updates.hasOwnProperty(l)&&(k[h.index][l]=h.updates[l]);else"delete"===h.type&&k.splice(h.index,1);e(k)})}};
Cable.interval=function(a,d){if(a.substring){var e=[a,"_pid"];d&&(e=e.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(e,function(a,d,e){clearInterval(d());a=setInterval(function(){e(new Date)},a());d(a)})}}return{type:"event",defaultValue:new Date,wireup:function(e){setInterval(function(){e(new Date)},a);d&&e(new Date)}}};Cable.library=function(a,d){return{type:"library",path:a,shim:d}};Cable.module=function(a){return{type:"module",url:a}};
Cable.pack=function(a){var d=function(a){for(var h={},k=1;k<d.argAliases.length;++k)h[d.argAliases[k]]=arguments[k]();a(h)};a=a.slice(0);a.splice(0,0,"result");d.argAliases=a;return d};Cable.counter=function(){return Cable.data(-1,{next:function(){var a=this()+1;this(a);return a}})};Cable.alias=function(a){return{type:"alias",reference:a}};Cable.textbox=function(a){return Cable.withArgs(["$","define"],function(d,e){e(Cable.withArgs(["event"],function(e){var k=d(a),l=function(){return k.is("[type='number']")?parseFloat(k.val()):k.val()};k.on("change keyup",function(){e(l())});e(l())}))})};Cable.checkbox=function(a){return Cable.withArgs(["$","define"],function(d,e){var h=d(a);e(Cable.withArgs(["event"],function(a){h.on("change",function(){a(h.is(":checked"))});a(h.is(":checked"))}))})};
Cable.button=function(a){return Cable.withArgs(["$","define"],function(d,e){e(Cable.withArgs(["event"],function(e){d(a).on("click",function(){e(new Date)})}))})};Cable.returnKey=function(a){return Cable.withArgs(["$","define"],function(d,e){e({type:"event",wireup:function(e){d(a).on("keyup",function(a){13===a.keyCode&&e(new Date)})}})})};
Cable.template=function(a,d){var e=(d.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(e),main:Cable.withArgs(["properties","$"],function(h,k){function l(a){return"number"===typeof a?a.toFixed(2):a}for(var n=d,m=0;m<e.length;++m)n=n.replace("{{"+e[m]+"}}",l(h()[e[m]]));k(a).html(n)})}};
Cable.json=function(a){return{url:a,main:Cable.withArgs(["$","url","result"],function(a,e,h){var k=/^http/.test(e())&&!/callback=/.test(e());a.ajax({dataType:"json",url:e(),crossDomain:!!k,success:function(a){h(a)}})})}};Cable.text=function(a){return Cable.withArgs(["$","result"],function(d,e){d.ajax({url:a,dataType:"text",success:function(a){e(a)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(a,d){var e={};a("[cable]").each(function(d,k){a(k).is(":text")?e[k.id]=Cable.textbox("#"+k.id):e[k.id]=Cable.template("#"+k.id,k.innerText)});d(e)})};
