/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-03-25T21:34:07.113Z              .
.......................................*/
'use strict';var Cable={};
(function(){function a(b,d){for(var h in b)b.hasOwnProperty(h)&&d(b[h],h)}function c(b){return b.argAliases?b.argAliases:(b+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(b){return b.replace(/(^\s+)|(\s+$)/g,"")})}function e(b,d){return c(b).filter(function(b){return-1==r.indexOf(b)}).map(function(b){return b.replace(/^_/,"")})}function g(b,d){return c(b).filter(function(b){return-1==r.indexOf(b)&&"_"!=b[0]})}function k(b){var d={};return b&&"[object Function]"===d.toString.call(b)}
function l(b,d){if(d){var h={};a(b,function(b,f){h[f]=d.hasOwnProperty(f)?d[f]:b});return h}return b}function n(b){function d(h){if(h.length){var c=h[0],a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b="("+this.responseText+")";delete f[c];var a={};try{a[c]=eval(b)}catch(e){throw"Failed to load module '"+c+"': "+e;}Cable.define(a,{reify:!1,wireup:!1});d(h.slice(1))}};a.open("get",f[c].url,!0);a.send()}else b()}var h=[],c;for(c in f)f.hasOwnProperty(c)&&
"module"===f[c].type&&h.push(c);d(h)}function m(b,d){for(var h=d.chain,c="main"===b?"":"_"+b,a=[],e=0;e<h.length;++e)a.push(h.slice(0,h.length-e).join("_")+c);a.push(b);for(h=0;h<a.length;++h)if(f.hasOwnProperty(a[h]))return a[h];return null}function w(){a(f,function(b){b.out=[]});a(f,function(b,d){b.fn&&g(b.fn,b.context).forEach(function(h){var c=m(h,b.scope);if(c)f[c].out.push(d);else throw"Reference to undefined node '"+h+"' as dependency of '"+d+"'";})})}function x(){a(f,function(b,d){"event"!==
b.type||b.isWiredUp||(b.wireup(function(b){p(d,function(d){d(b)})}),b.isWiredUp=!0)})}function p(b,d){if(f.hasOwnProperty(b))y[f[b].type](b,d);else throw"Cannot generate: '"+b+"' is not defined";}function q(b,d,c,a){void 0===c&&(c=[]);b.length?a&&a.hasOwnProperty(b[0])?q(b.slice(1),d,c.concat([a[b[0]]]),a):p(b[0],function(f){q(b.slice(1),d,c.concat([f]),a)}):d(c)}function u(b,d){var c=f[b]["in"].map(function(d){return m(d,f[b].scope)});q(c,d)}function s(b,d){z[f[b].type](b,d)}function t(b){s(b,function(){})}
var r=["result","respond","define","type","event"],f={};Cable._debug=function(){return f};Cable.each=a;Cable.define=function(b,d){d=l({reify:!0,wireup:!0,scope:{chain:[]}},d);a(b,function(b,a){if(/^_/.test(a))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=r.indexOf(a))throw"Illegal definition: "+a+" is a reserved word.";if(f.hasOwnProperty(a))throw"Illegal definition: "+a+" is already defined.";var e=null,e=b.hasOwnProperty("type")?b.type:k(b)?-1!=c(b).indexOf("result")||
-1!=c(b).indexOf("respond")?"synthetic":"effect":"sub";if(v.hasOwnProperty(e))v[e](a,b,d.scope);else if("sub"!==e)throw"Illegal definiton: could not determine meaning of "+a;});(d.reify||d.wireup)&&n(function(){d.reify&&w();d.wireup&&x()})};var v={data:function(b,d,a){f[b]={type:"data",value:d.value,"in":[],out:[],helpers:d.helpers?d.helpers:{},scope:a}},synthetic:function(b,d,a){-1!=c(d).indexOf("respond")?f[b]={type:"synthetic",fn:d,value:null,invoked:!1,"in":e(d,d.context),out:[],resultIndex:c(d).indexOf("respond"),
scope:a,coalesce:!1}:f[b]={type:"synthetic",fn:d,value:null,invoked:!1,"in":e(d,d.context),out:[],resultIndex:c(d).indexOf("result"),scope:a,coalesce:!0}},effect:function(b,d,a){f[b]={type:"effect",fn:d,"in":e(d,d.context),out:[],scope:a}},event:function(b,d,a){f[b]={type:"event",value:d.defaultValue,wireup:d.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:a}},library:function(b,a,c){f[b]={type:"library",path:a.path,shim:a.shim,handle:null,loaded:!1,scope:c}},sub:function(b,d,c){var f={};a(d,
function(a,d){f["main"===d?b:b+"_"+d]=a});Cable.define(f,{reify:!1,wireup:!1,scope:{chain:c.chain.concat([b])}})},module:function(b,a,c){f[b]={type:"module",url:a.url,scope:c}}},y={data:function(b,d){var c=function(){if(!arguments.length)return f[b].value;arguments[0]!=f[b].value&&(f[b].value=arguments[0],f[b].out.forEach(t))};a(f[b].helpers,function(b,a){c[a]=function(){return b.apply(c,arguments)}});d(c)},synthetic:function(b,a){f[b].invoked?a(function(){return f[b].value}):s(b,function(){})},effect:function(){},
event:function(b,a){a(function(){if(!arguments.length)return f[b].value;arguments[0]==f[b].value&&f[b].coalesce||(f[b].invoked=!0,f[b].value=arguments[0],f[b].out.forEach(t))})},library:function(b,a){f[b].loaded?a(f[b].handle):s(b,function(){p(b,a)})}};Cable.generate=p;var z={data:p.data,event:p.event,synthetic:function(b,a){u(b,function(c){c.splice(f[b].resultIndex,0,function(c){f[b].invoked=!0;f[b].value==c&&f[b].coalesce||(f[b].value=c,f[b].out.forEach(t));a()});f[b].fn.apply({},c)})},effect:function(b,
a){u(b,function(c){f[b].fn.apply({},c);a()})},library:function(b,a){if(f[b].loaded)a();else{var c=function(){var a,c,d=0;arguments[d].substring&&d++;a=arguments[d].splice?arguments[d++]:["require","exports","module"];if(k(arguments[d])){var e=arguments[d];c=-1!==a.indexOf("exports")?function(){var b=e.apply(window,arguments);return void 0!==b?b:void 0}:e}else{var g=arguments[d];c=function(){return g}}q(a,function(){f[b].handle=c.apply(window,arguments);f[b].loaded=!0},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";
},exports:void 0,module:null})};c.amd={};var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=this.responseText;f[b].shim&&(e=["define(function() {",e,"\nreturn ",f[b].shim,"; });"].join(""));window.define=c;eval(e);delete window.define;"$"===b&&$&&$.noConflict&&$.noConflict();a()}};e.open("get",f[b].path,!0);e.send()}}};Cable.initialize=function(b,a){"synthetic"===f[b].type&&(f[b].value=a,f[b].invoked=!0)}})();Cable.withArgs=function(a,c){c.argAliases=a;return c};Cable.data=function(a,c){var e={type:"data",value:a};c&&(e.helpers=c);return e};Cable.define({init:{type:"event",wireup:function(a){a(new Date)}}},{reify:!1,wireup:!1});
Cable.list=function(a){return{array:Cable.data(a),main:Cable.data({type:"initialize",array:a},{insertAt:function(a,e){this({type:"insert",index:a,element:e})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,e){this({type:"update",index:a,updates:e})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,e){var g=a(),k=e().slice(0);if("insert"===g.type)k.splice(0<=
g.index?g.index:k.length,0,g.element);else if("update"===g.type)for(var l in g.updates)g.updates.hasOwnProperty(l)&&(k[g.index][l]=g.updates[l]);else"delete"===g.type&&k.splice(g.index,1);e(k)})}};
Cable.interval=function(a,c){if(a.substring){var e=[a,"_pid"];c&&(e=e.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(e,function(a,c,e){clearInterval(c());a=setInterval(function(){e(new Date)},a());c(a)})}}return{type:"event",defaultValue:new Date,wireup:function(e){setInterval(function(){e(new Date)},a);c&&e(new Date)}}};Cable.library=function(a,c){return{type:"library",path:a,shim:c}};Cable.module=function(a){return{type:"module",url:a}};
Cable.pack=function(a){var c=function(a){for(var g={},k=1;k<c.argAliases.length;++k)g[c.argAliases[k]]=arguments[k]();a(g)};a=a.slice(0);a.splice(0,0,"result");c.argAliases=a;return c};Cable.counter=function(){return Cable.data(-1,{next:function(){var a=this()+1;this(a);return a}})};Cable.event=function(a,c,e,g){return{type:"event",coalesce:!1,wireup:function(k){Cable.generate("$",function(l){if("document"===a&&"ready"===c)l(document).ready(k);else{var n=function(){var c=null,g=l(a);e||(e="time");"value"===e?(c=g.val(),g.is("[type='number']")&&(c=parseFloat(c))):"time"===e?c=new Date:/^data-[-_a-zA-Z0-9]+/.test(e)?c=g.attr(e):":checked"===e&&(c=g.is(":checked"));k(c)},m;"key-return"===c?(c="keyup",m=function(a){13===a.keyCode&&n()}):m=n;l(document).on(c,a,m);g&&n()}})}}};
Cable.textbox=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(e){var g=e(a),k=function(){return g.is("[type='number']")?parseFloat(g.val()):g.val()};g.on("change keyup",function(){c(k())});c(k())})}}};Cable.checkbox=function(a){return Cable.event(a,"change",":checked",!0)};Cable.button=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(e){e(a).on("click",function(){c(new Date)})})}}};
Cable.returnKey=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(e){e(a).on("keyup",function(a){13===a.keyCode&&c(new Date)})})}}};Cable.template=function(a,c){var e=(c.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(e),main:Cable.withArgs(["properties","$"],function(g,k){function l(a){return"number"===typeof a?a.toFixed(2):a}for(var n=c,m=0;m<e.length;++m)n=n.replace("{{"+e[m]+"}}",l(g()[e[m]]));k(a).html(n)})}};
Cable.json=function(a){return{url:a,main:Cable.withArgs(["$","url","result"],function(a,e,g){var k=/^http/.test(e())&&!/callback=/.test(e());a.ajax({dataType:"json",url:e(),crossDomain:!!k,success:function(a){g(a)}})})}};Cable.text=function(a){return Cable.withArgs(["$","result"],function(c,e){c.ajax({url:a,dataType:"text",success:function(a){e(a)}})})};
