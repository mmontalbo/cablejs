/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-04-08T21:56:30.774Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function b(a,c){for(var g in a)a.hasOwnProperty(g)&&c(a[g],g)}function d(a){if(a.argAliases)return a.argAliases;a=(a+"").match(/^function(\s*)?\(([^)]*)\)/m)[2];return a.length?a.split(",").map(function(a){return a.replace(/(^\s+)|(\s+$)/g,"")}):[]}function e(a,c){return d(a).filter(function(a){return-1==r.indexOf(a)}).map(function(a){return a.replace(/^_/,"")})}function h(a,c){return d(a).filter(function(a){return-1==r.indexOf(a)&&"_"!=a[0]})}function k(a){var c={};return a&&"[object Function]"===
c.toString.call(a)}function l(a,c){if(c){var g={};b(a,function(a,f){g[f]=c.hasOwnProperty(f)?c[f]:a});return g}return a}function n(a){function c(g){if(g.length){var d=g[0],b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a="("+this.responseText+")";delete f[d];var b={};try{b[d]=eval(a)}catch(e){throw"Failed to load module '"+d+"': "+e;}Cable.define(b,{reify:!1,wireup:!1});c(g.slice(1))}};b.open("get",f[d].url,!0);b.send()}else a()}var g=[],d;for(d in f)f.hasOwnProperty(d)&&
"module"===f[d].type&&g.push(d);c(g)}function m(a,c){for(var g=c.chain,d="main"===a?"":"_"+a,b=[],e=0;e<g.length;++e)b.push(g.slice(0,g.length-e).join("_")+d);b.push(a);for(g=0;g<b.length;++g)if(f.hasOwnProperty(b[g]))return"alias"===f[b[g]].type?(b=f[b[g]],m(b.reference,b.scope)):b[g];return null}function v(){b(f,function(a){a.out=[]});b(f,function(a,c){a.fn&&h(a.fn,a.context).forEach(function(g){var b=m(g,a.scope);if(b)f[b].out.push(c);else throw"Reference to undefined node '"+g+"' as dependency of '"+
c+"'";})})}function x(){b(f,function(a,c){if("subdefinition"===a.type)if(y(c))s(c,function(g){g.splice(a.defineIndex,0,function(g){var b={};b[c]=g;Cable.define(b,{scope:a.scope})});delete f[c];a.fn.apply(window,g)});else throw"Illegal subdefinition: "+c+". Subdefs must depend only on libraries";})}function z(){b(f,function(a,c){if("event"===a.type&&!a.isWiredUp){var g=function(a){p(c,function(c){c(a)})};g.setDefault=function(c){a.value=c};a.wireup(g);a.isWiredUp=!0}})}function p(a,c){if(f.hasOwnProperty(a))A[f[a].type](a,
c);else throw"Cannot generate: '"+a+"' is not defined";}function q(a,c,g,b){void 0===g&&(g=[]);a.length?b&&b.hasOwnProperty(a[0])?q(a.slice(1),c,g.concat([b[a[0]]]),b):p(a[0],function(f){q(a.slice(1),c,g.concat([f]),b)}):c(g)}function s(a,c){var g=f[a]["in"].map(function(c){return m(c,f[a].scope)});q(g,c)}function t(a,c){B[f[a].type](a,c)}function u(a){t(a,function(){})}function y(a){return f[a]["in"].map(function(c){return"library"===f[m(c,f[a].scope)].type}).reduce(function(a,g){return a&&g})}var r=
["result","respond","type","event","define"],f={};Cable._debug=function(){return f};Cable.each=b;Cable.define=function(a,c){c=l({reify:!0,wireup:!0,scope:{chain:[]}},c);b(a,function(a,b){if(/^_/.test(b))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=r.indexOf(b))throw"Illegal definition: "+b+" is a reserved word.";if(f.hasOwnProperty(b))throw"Illegal definition: "+b+" is already defined.";var e=null;a.hasOwnProperty("type")?e=a.type:k(a)?(e=a,-1!=d(e).indexOf("result")||
-1!=d(e).indexOf("respond")?e="synthetic":-1!==d(a).indexOf("define")?e="subdefinition":(e=d(a),1===e.length&&"event"===e[0]?(e="event",a={type:"event",wireup:a}):e="effect")):e="scope";if(w.hasOwnProperty(e))w[e](b,a,c.scope);else throw"Illegal definiton: could not determine meaning of "+b;});(c.reify||c.wireup)&&n(function(){c.reify&&(v(),x(),v());c.wireup&&z()})};var w={data:function(a,c,b){f[a]={type:"data",value:c.value,"in":[],out:[],helpers:c.helpers?c.helpers:{},scope:b}},synthetic:function(a,
c,b){-1!=d(c).indexOf("respond")?f[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":e(c,c.context),out:[],resultIndex:d(c).indexOf("respond"),scope:b,coalesce:!1}:f[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":e(c,c.context),out:[],resultIndex:d(c).indexOf("result"),scope:b,coalesce:!0}},effect:function(a,c,b){f[a]={type:"effect",fn:c,"in":e(c,c.context),out:[],scope:b}},event:function(a,c,b){f[a]={type:"event",value:c.defaultValue,wireup:c.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],
scope:b}},library:function(a,c,b){f[a]={type:"library",path:c.path,shim:c.shim,handle:null,loaded:!1,scope:b}},scope:function(a,c,f){var d={};b(c,function(c,b){d["main"===b?a:a+"_"+b]=c});c=f.chain.map(function(a){return a+"_"}).join("_");f=f.chain.concat([a.slice(c.length)]);Cable.define(d,{reify:!1,wireup:!1,scope:{chain:f}})},subdefinition:function(a,c,b){f[a]={type:"subdefinition",in:e(c),fn:c,scope:b,defineIndex:d(c).indexOf("define")}},module:function(a,b,d){f[a]={type:"module",url:b.url,scope:d}},
alias:function(a,b,d){f[a]={type:"alias",reference:b.reference,scope:d}}},A={data:function(a,c){var d=function(){if(!arguments.length)return f[a].value;arguments[0]!=f[a].value&&(f[a].value=arguments[0],f[a].out.forEach(u))};b(f[a].helpers,function(a,b){d[b]=function(){return a.apply(d,arguments)}});c(d)},synthetic:function(a,b){f[a].invoked?b(function(){return f[a].value}):t(a,function(){})},effect:function(){},event:function(a,b){b(function(){if(!arguments.length)return f[a].value;arguments[0]==
f[a].value&&f[a].coalesce||(f[a].invoked=!0,f[a].value=arguments[0],f[a].out.forEach(u))})},library:function(a,b){f[a].loaded?b(f[a].handle):t(a,function(){p(a,b)})}},B={data:p.data,event:p.event,synthetic:function(a,b){s(a,function(d){d.splice(f[a].resultIndex,0,function(d){f[a].invoked=!0;f[a].value==d&&f[a].coalesce||(f[a].value=d,f[a].out.forEach(u));b()});f[a].fn.apply({},d)})},effect:function(a,b){s(a,function(d){f[a].fn.apply({},d);b()})},library:function(a,b){if(f[a].loaded)b();else{var d=
function(){var d,e,g={},h=0;arguments[h].substring&&h++;d=arguments[h].splice?arguments[h++]:["require","exports","module"];if(k(arguments[h])){var l=arguments[h];e=-1!==d.indexOf("exports")?function(){var a=l.apply(window,arguments);return void 0!==a?a:g}:l}else{var m=arguments[h];e=function(){return m}}q(d,function(d){f[a].handle=e.apply(window,d);f[a].loaded=!0;b()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";},exports:g,module:null})};d.amd={};var e=
new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b=this.responseText;f[a].shim&&(b=["define(function() {",b,"\nreturn ",f[a].shim,"; });"].join(""));window.define=d;try{eval(b)}catch(c){throw"Failed evaluating library "+a+": "+c;}delete window.define;"$"===a&&$&&$.noConflict&&$.noConflict()}};e.open("get",f[a].path,!0);e.send()}}};Cable.initialize=function(a,b){"synthetic"===f[a].type&&(f[a].value=b,f[a].invoked=!0)};Cable._private&&(Cable._private=
{getArgNames:d,getFanIn:e,getDependencies:h})})();Cable.withArgs=function(b,d){d.argAliases=b;return d};Cable.data=function(b,d){var e={type:"data",value:b};d&&(e.helpers=d);return e};Cable.define({init:Cable.withArgs(["event"],function(b){b(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(b){return{array:Cable.data(b),main:Cable.data({type:"initialize",array:b},{insertAt:function(b,e){this({type:"insert",index:b,element:e})},prepend:function(b){this({type:"insert",index:0,element:b})},append:function(b){this({type:"insert",index:-1,element:b})},updateAt:function(b,e){this({type:"update",index:b,updates:e})},deleteAt:function(b){this({type:"delete",index:b})}}),updater:Cable.withArgs(["main","_array"],function(b,e){var h=b(),k=e().slice(0);if("insert"===h.type)k.splice(0<=
h.index?h.index:k.length,0,h.element);else if("update"===h.type)for(var l in h.updates)h.updates.hasOwnProperty(l)&&(k[h.index][l]=h.updates[l]);else"delete"===h.type&&k.splice(h.index,1);e(k)})}};
Cable.interval=function(b,d){if(b.substring){var e=[b,"_pid"];d&&(e=e.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(e,function(b,d,e){clearInterval(d());b=setInterval(function(){e(new Date)},b());d(b)})}}return{type:"event",defaultValue:new Date,wireup:function(e){setInterval(function(){e(new Date)},b);d&&e(new Date)}}};Cable.library=function(b,d){return{type:"library",path:b,shim:d}};Cable.module=function(b){return{type:"module",url:b}};
Cable.pack=function(b){var d=function(b){for(var h={},k=1;k<d.argAliases.length;++k)h[d.argAliases[k]]=arguments[k]();b(h)};b=b.slice(0);b.splice(0,0,"result");d.argAliases=b;return d};Cable.counter=function(){return Cable.data(-1,{next:function(){var b=this()+1;this(b);return b}})};Cable.alias=function(b){return{type:"alias",reference:b}};Cable.textbox=function(b){return Cable.withArgs(["$","define"],function(d,e){e(Cable.withArgs(["event"],function(e){var k=d(b),l=function(){return k.is("[type='number']")?parseFloat(k.val()):k.val()};k.on("change keyup",function(){e(l())});e(l())}))})};Cable.checkbox=function(b){return Cable.withArgs(["$","define"],function(d,e){var h=d(b);e(Cable.withArgs(["event"],function(b){h.on("change",function(){b(h.is(":checked"))});b(h.is(":checked"))}))})};
Cable.button=function(b){return Cable.withArgs(["$","define"],function(d,e){e(Cable.withArgs(["event"],function(e){d(b).on("click",function(){e(new Date)})}))})};Cable.returnKey=function(b){return Cable.withArgs(["$","define"],function(d,e){e({type:"event",wireup:function(e){d(b).on("keyup",function(b){13===b.keyCode&&e(new Date)})}})})};
Cable.template=function(b,d){var e=(d.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(b){return b.replace(/\{|\}/g,"")});return{properties:Cable.pack(e),main:Cable.withArgs(["properties","$"],function(h,k){function l(b){return"number"===typeof b?b.toFixed(2):b}for(var n=d,m=0;m<e.length;++m)n=n.replace("{{"+e[m]+"}}",l(h()[e[m]]));k(b).html(n)})}};
Cable.json=function(b){return{url:b,main:Cable.withArgs(["$","url","result"],function(b,e,h){var k=/^http/.test(e())&&!/callback=/.test(e());b.ajax({dataType:"json",url:e(),crossDomain:!!k,success:function(b){h(b)}})})}};Cable.text=function(b){return Cable.withArgs(["$","result"],function(d,e){d.ajax({url:b,dataType:"text",success:function(b){e(b)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(b,d){var e={};b("[cable]").each(function(d,k){b(k).is(":text")?e[k.id]=Cable.textbox("#"+k.id):e[k.id]=Cable.template("#"+k.id,k.innerText)});d(e)})};
